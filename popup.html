<html>
<head>
  <title>KlavoTools - Popup</title>
  <link href="res/popup.css" type="text/css" rel="stylesheet" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
</head>
<body>
  <nav id="menu" main-menu>Menu loading...</nav>

  <!-- User search form -->
  <form class="search-user" ng-controller="popup:SearchUser as SearchUser">
    <input autofocus
      type="text"
      tabindex="1"
      ng-model="SearchUser.login"
      placeholder="Поиск игрока по нику" /><button tabindex="2"
        ng-click="SearchUser.search()"
      ng-disabled="SearchUser.loading"
      ng-class="{'loading': SearchUser.loading}">
        <span ng-if="!SearchUser.loading">Найти</span>
        <span ng-if="SearchUser.loading">Поиск...</span>
    </button>

    <span ng:if="SearchUser.id===false">не найден</span>
    <span ng:if="SearchUser.id!=0" class="get-id-links">
      ID: {{SearchUser.id}} |
      <a title="Профиль">
        <img ng:path ng:path:str="/u/#/{{SearchUser.id}}/" src="icons/profile.png" />
      </a>
      <a title="Статистика">
        <img ng:path ng:path:str="/u/#/{{SearchUser.id}}/stats/" src="icons/sprint.png" />
      </a>
      <a title="Бортжурнал">
        <img ng:path ng:path:str="/u/#/{{SearchUser.id}}/journal/" src="icons/usefuladdons.png" />
      </a>
      <!--
        TODO: add links to achievements and friends.
      -->
    </span>
  </form>

  <!-- Mail -->
  <div class="mail" ng:controller="popup:Mail as Mail">
    <div ng:init="Mail.HideReadMsg = true" ng:click="Mail.HideReadMsg = !Mail.HideReadMsg">
      <input type="checkbox" title="Скрыть прочитанные" ng:model="Mail.HideReadMsg" /> Сообщения:
    </div>
    <div
      ng:repeat="message in Mail.data.messages"
      ng:if="message.unread || !Mail.HideReadMsg"
      class="message"
      style="background: transparent url(http://img.klavogonki.ru/avatars/{{message.respondent_id}}_big.gif) no-repeat">

      <div>
        <a class="login" ng:path ng:path:str="/u/#/{{message.respondent_id}}/" ng:bind="Mail.data.users[message.respondent_id].login"></a>
        <span class="date" ng:bind="message.date.sec * 1000 | date"></span>
        <a class="read" ng:path ng:path:str="/u/#/{{message.user_id}}/messages/{{message.respondent_id}}">Диалог >></a>
      </div>
      <div class="text" ng:bind="message.text"></div>
    </div>
  </div>

  <!-- Fast links editor -->
  <div class="editor" ng:controller="popup:FastLinks as FastLinks" ng:show="FastLinks.visible">
    <textarea ng:model="FastLinks.txtlinks"></textarea>
    <div class="note">* <b>"__USERID__"</b> будет заменяться на ID активного аккаунта</div>
    <table>
      <tr>
        <td>Текст:</td>
        <td class="td-center">
          <input tabindex='3' type="text" ng:model="FastLinks.title" />
        </td>
        <td class="td-right">
          <input tabindex='5' type="button" value="Добавить" ng:click="FastLinks.add()" />
        </td>
      </tr>
      <tr>
        <td>Ссылка:</td>
        <td class="td-center">
          <input tabindex='4' type="text" ng:model="FastLinks.url" />
        </td>
        <td class="td-right">
          <input tabindex='6' type="button" value="Сохранить" ng:click="FastLinks.save()" />
        </td>
      </tr>
    </table>
  </div>

  <script type="text/ng-template" id="mainMenuTemplate">
    <ul>
      <li ng-repeat="m in menu">
        <a ng-path="m.path">{{m.title}}</a>
        <ul>
          <li ng-repeat="sub in m.sub" ng-class="{'icon': sub.icon}">
            <a ng-path="sub.path"><img ng-if="!!sub.icon" ng-src="{{sub.icon}}" alt=""><span>{{sub.title}}</span></a>
          </li>
        </ul>
      </li><li>
        <a>Ссылки</a>
        <ul>
          <li>
            <a ng-click="openEditor()"><i>{{links.length ? "Изменить" : "Добавить"}}</i></a>
          </li>
          <li ng-repeat="fl in links">
            <a ng-path="fl.url">{{fl.title}}</a>
          </li>
        </ul>
      </li><li class="icon">
        <a ng-path ng-path-str="__EXTENSION_OPTIONS__" title="Настройки KlavoTools">
          <img src="icons/button.png" alt="">
        </a>
      </li>
    </ul>
  </script>
  <script src="kango-ui/kango_api.js"></script>
  <script src="klavotools/foreground/lib/angular.min.js"></script>
  <script src="klavotools/foreground/lib/kango-q.js"></script>
  <script src="klavotools/popup/popup.js"></script>
  <script src="klavotools/popup/popup.menutree.js"></script>
  <script src="klavotools/popup/popup.redirect.js"></script>
  <script src="klavotools/popup/popup.fl-editor.js"></script>
</body>
</html>
